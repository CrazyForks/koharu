import {
    AppMenuBar,
    AppMenu,
    AppMenuItem,
    AppMenuSeparator,
} from "menubar.slint";
import { Logic } from "logic.slint";
import { State } from "state.slint";
import { ThumbnailPanel, ThumbnailItem } from "thumbnail.slint";
import { Workflow, WorkflowItem, WorkflowConnector } from "workflow.slint";
import { DetectionPanel } from "detection.slint";
import { Canvas, CanvasControl } from "canvas.slint";

// re-export for the native code
// refer: https://github.com/slint-ui/slint/blob/24d37751e8245af46722e8e8aa9fb74bf6639489/examples/printerdemo/ui/printerdemo.slint#L11
export { Logic, State }

export component App inherits Window {
    in-out property <int> scale: 100;

    max-width: 3840px;
    max-height: 2160px;
    preferred-width: 1024px;
    preferred-height: 768px;
    title: "Koharu";
    icon: @image-url("assets/Koharu_Halo.webp");

    VerticalLayout {
        AppMenuBar {
            AppMenu {
                title: "File";

                AppMenuItem {
                    title: "Open File...";
                    clicked => {
                        Logic.open_file();
                    }
                }
            }

            AppMenu {
                title: "Help";

                AppMenuItem {
                    title: "Discord";
                    clicked => {
                        Logic.open_external("https://discord.gg/mHvHkxGnUY");
                    }
                }

                AppMenuItem {
                    title: "GitHub";
                    clicked => {
                        Logic.open_external("https://github.com/mayocream/koharu");
                    }
                }
            }
        }

        HorizontalLayout {
            ThumbnailPanel {
                for image in State.images: ThumbnailItem {
                    title: image.name;
                    source: image.source;
                    clicked => {
                        State.current-image = image;
                    }
                }
            }

            VerticalLayout {
                Workflow {
                    WorkflowItem {
                        title: "Detection";
                    }

                    WorkflowConnector { }

                    WorkflowItem {
                        title: "Inpainting";
                    }

                    WorkflowConnector { }

                    WorkflowItem {
                        title: "Translation";
                    }
                }

                Canvas {
                    scale: root.scale;
                }

                CanvasControl {
                    scale <=> root.scale;
                }
            }

            VerticalLayout {
                DetectionPanel { }
            }
        }
    }
}
