import { ScrollView } from "std-widgets.slint";
import { TextBlock } from "types.slint";
import { State } from "state.slint";
import { Logic } from "logic.slint";

export component DetectionItem inherits Rectangle {
    in property <TextBlock> text-block;
    in property <int> index;

    background: white;
    border-radius: 4px;
    border-width: 1px;
    border-color: #E0E0E0;

    HorizontalLayout {
        padding: 4px;
        spacing: 6px;
        alignment: start;

        Text {
            text: root.index;
            color: #666666;
            font-size: 11px;
            font-weight: 600;
            width: 10px;
            vertical-alignment: top;
        }

        Text {
            text: root.text-block.text.is-empty ? "<empty>" : root.text-block.text;
            color: #333333;
            font-size: 12px;
            vertical-alignment: top;
            wrap: word-wrap;
        }
    }
}

export component DetectionPanel inherits Rectangle {
    property <[TextBlock]> text-blocks: State.text-blocks;

    width: 200px;
    background: #FAFAFA;
    border-width: 1px;
    border-color: #E0E0E0;

    VerticalLayout {
        padding: 8px;
        spacing: 8px;

        HorizontalLayout {
            spacing: 8px;
            alignment: start;

            Rectangle {
                // Spacer
            }

            detect-button := TouchArea {
                width: 80px;
                height: 30px;
                mouse-cursor: MouseCursor.pointer;

                button-rect := Rectangle {
                    width: parent.width;
                    height: parent.height;
                    background: white;
                    border-radius: 15px;
                    border-width: 1px;
                    border-color: #E0E0E0;

                    Text {
                        text: "Detect";
                        color: #333333;
                        font-size: 12px;
                        font-weight: 400;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                }

                states [
                    hover when self.has-hover: {
                        button-rect.background: #F5F5F5;
                    }
                ]

                clicked => {
                    Logic.detect(State.image);
                }
            }
        }

        ScrollView {
            VerticalLayout {
                spacing: 4px;
                alignment: start;

                if root.text-blocks.length == 0: Text {
                    text: "No text blocks detected yet.";
                    color: #666666;
                    font-size: 12px;
                    horizontal-alignment: center;
                }

                for block[index] in root.text-blocks: DetectionItem {
                    text-block: block;
                    index: index + 1;
                }
            }
        }
    }
}
